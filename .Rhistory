px, supfam, spe, ens_alg
),
full.names = T
),
\(f) {
out <- if (px == "adequation_environnementale") {
rast(f)
} else {
Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
}
return(out)
},
simplify = F,
USE.NAMES = T
)
out
out %>% length()
list.files(
here(
"data", "analysis", "compilation",
px, supfam, spe, ens_alg
),
full.names = T
)
list.files(
here(
"data", "analysis", "compilation",
px, supfam, spe, ens_alg
),
full.names = T
)[[1]] -> f
out <- if (px == "adequation_environnementale") {
rast(f)
} else {
Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
}
out
out_pa <- Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
length(`/home/borea/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/data/analysis/compilation/presence_absence/Majoidea/Mithraculus forceps/ca/KAPPA/presence-absence_ens5_current_EMca_CPwmean_w1-2-3_CTkappa784.tif`)
length(out_pa)
length(out_pa$`/home/borea/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/data/analysis/compilation/presence_absence/Majoidea/Mithraculus forceps/ca/KAPPA/presence-absence_ens5_current_EMca_CPwmean_w1-2-3_CTkappa784.tif`)
out_pa
out_pa <- Reduce(c, out_pa)
list.files(f)
t <- list.files(f) %>%
str_split("_") %>%
unlist() %>%
table()
r
t
names(out_pa)
names(t)[t == 1]
names(out_pa)
out_pa@ptr
out_pa$CTkappa784
out_pa
names(t)[t == 1] %>%
paste(names(out_pa), sep = ".")
out_pa <- as.list(out_pa)
names(t)[t == 1]
names(out_pa) <- names(t)[t == 1] %>%
paste(names(out_pa), sep = ".")
names(out_pa)
out_pa <- Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
out_pa <- Reduce(c, out_pa)
t <- list.files(f) %>%
str_split("_") %>%
unlist() %>%
table()
names(out_pa) <- names(t)[t == 1] %>%
paste(names(out_pa), sep = ".")
out_pa <- as.list(out_pa)
names(out_pa) <- names(t)[t == 1]
out_pa$current
out <- Sapply(
list.files(
here(
"data", "analysis", "compilation",
px, supfam, spe, ens_alg
),
full.names = T
),
\(f) {
out <- if (px == "adequation_environnementale") {
rast(f)
} else {
out_pa <- Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
out_pa <- Reduce(c, out_pa)
t <- list.files(f) %>%
str_split("_") %>%
unlist() %>%
table()
names(out_pa) <- names(t)[t == 1] %>%
paste(names(out_pa), sep = ".")
out_pa <- as.list(out_pa)
names(out_pa) <- names(t)[t == 1]
out_pa
}
return(out)
},
simplify = F,
USE.NAMES = T
)
out
out <- if(px == "adequation_environnementale") {
Reduce(c, out)
} else {
Sapply(out, \(x) Reduce(c, x))
}
out
out
out <- Sapply(
list.files(
here(
"data", "analysis", "compilation",
px, supfam, spe, ens_alg
),
full.names = T
),
\(f) {
out <- if (px == "adequation_environnementale") {
rast(f)
} else {
out_pa <- Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
out_pa <- Reduce(c, out_pa)
t <- list.files(f) %>%
str_split("_") %>%
unlist() %>%
table()
names(out_pa) <- names(t)[t == 1] %>%
paste(names(out_pa), sep = ".")
out_pa <- as.list(out_pa)
names(out_pa) <- names(t)[t == 1]
out_pa
}
return(out)
},
simplify = F,
USE.NAMES = T
)
out
names(out)
names(out[[1]])
list.files(
here(
"data", "analysis", "compilation",
px, supfam, spe, ens_alg
)
)
names(out) <- list.files(
here("data", "analysis", "compilation",
px, supfam, spe, ens_alg))
out <- transpose(out)
out <- if(px == "adequation_environnementale") {
Reduce(c, out)
} else {
names(out) <- list.files(
here("data", "analysis", "compilation",
px, supfam, spe, ens_alg))
out <- transpose(out)
Sapply(out, \(x) Reduce(c, x))
}
px == "adequation_environnementale"
out <- Sapply(
list.files(
here(
"data", "analysis", "compilation",
px, supfam, spe, ens_alg
),
full.names = T
),
\(f) {
out <- if (px == "adequation_environnementale") {
rast(f)
} else {
out_pa <- Sapply(
list.files(f, full.names = T), rast,
simplify = F, USE.NAMES = T
)
out_pa <- Reduce(c, out_pa)
t <- list.files(f) %>%
str_split("_") %>%
unlist() %>%
table()
names(out_pa) <- names(t)[t == 1] %>%
paste(names(out_pa), sep = ".")
out_pa <- as.list(out_pa)
names(out_pa) <- names(t)[t == 1]
out_pa
}
return(out)
},
simplify = F,
USE.NAMES = T
)
out <- if(px == "adequation_environnementale") {
Reduce(c, out)
} else {
names(out) <- list.files(
here("data", "analysis", "compilation",
px, supfam, spe, ens_alg))
out <- transpose(out)
Sapply(out, \(x) Reduce(c, x))
}
out
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/popa_import.R")
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca$current.CTkappa897
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca$ssp126
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca$ssp585
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca$current
dis$adequation_environnementale$Majoidea$`Amphithrax hemphilli`$ca %>% length()
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca %>% length()
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca$current %>% length()
dis$presence_absence$Majoidea$`Amphithrax hemphilli`$ca$current
# RÃ©duction par temps de projection
dis_reduc <- Sapply(
names(dis),
\(px) {
# px <- "adequation_environnementale"
Sapply(
names(dis[[px]]),
\(supfam) {
# supfam <- "Majoidea"
Sapply(
names(dis[[px]][[supfam]]),
\(bn) {
# bn <- "Amphithrax hemphilli"
Sapply(
names(dis[[px]][[supfam]][[bn]]),
\(ens_alg) {
# ens_alg <- "ca"
Reduce(c, dis[[px]][[supfam]][[bn]][[ens_alg]])
})
})
})
})
dis_reduc$adequation_environnementale$Majoidea$`Amphithrax hemphilli`$ca
dis_reduc$presence_absence$Majoidea$`Amphithrax hemphilli`$ca
# presence-absence | committee averaging
pa <- dis$presence_absence
# presence-absence | committee averaging
pa <- dis$presence_absence
paca <- Reduce(
c,
lapply(
pa,
\(pa_sf) {
lapply(
pa_sf,
\(pa_bn) {
z <- pa_bn %>%
lapply(pluck, 1) %>%
unlist()
Reduce(c, z)
})
})
)
paca
paca %>% length()
pa_sf <- pa$Majoidea
pa_bn <- pa_sf$`Amphithrax hemphilli`
pa_bn
popaPlot <- function(
projRasters, superfamily = "all", )
type <- "adequation_environnementale"
projRasters <- dis
# type <- "presence_absence"
o <- projRasters[[type]]
o
o_sf <- o$Majoidea
o_bn <- o_sf$`Amphithrax hemphilli`
# o_bn <- o_sf$`Amphithrax hemphilli`
z <- o_bn %>%
lapply(pluck, 1) %>%
unlist()
o_bn
names(o_bn)
ensemble_algorithm <- "ca"
o_bn %>%
lapply(pluck, ensemble_algorithm)
o_bn <- o_sf$`Amphithrax hemphilli`
o_bn
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]]
# type <- "presence_absence"
projection_time <- "current"
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
o <- if (superfamily != "all") list(o[[superfamily]]) else o
superfamily = "all"
o <- projRasters[[type]]
o <- if (superfamily != "all") list(o[[superfamily]]) else o
o
out <- Reduce(
c,
lapply(
o,
\(o_sf) {
# o_sf <- o$Majoidea
lapply(
o_sf,
\(o_bn) {
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
})
})
)
out
out %>% length()
lapply(
o,
\(o_sf) {
# o_sf <- o$Majoidea
lapply(
o_sf,
\(o_bn) {
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
})
})
o <- projRasters[[type]]
o <- if (superfamily != "all") list(o[[superfamily]]) else o
out <- Sapply(
o,
\(o_sf) {
# o_sf <- o$Majoidea
Sapply(
o_sf,
\(o_bn) {
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
})
})
out
out <- Sapply(
o,
\(o_sf) {
# o_sf <- o$Majoidea
Sapply(
o_sf,
\(o_bn) {
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
})
})
out <- Reduce(\(x) Reduce(c, x), out)
out <- out %>% Reduce(c, .) %>% Reduce(c, .)
out
out <- Sapply(
o,
\(o_sf) {
# o_sf <- o$Majoidea
Sapply(
o_sf,
\(o_bn) {
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
})
})
out <- Reduce(c, out)
names(ouy)
names(out)
out
?mapply
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_Mapply.R")
out <- Sapply(
o,
\(o_sf) {
# o_sf <- o$Majoidea
Sapply(
o_sf,
\(o_bn) {
# o_bn <- o_sf$`Amphithrax hemphilli`
o_bn[[ensemble_algorithm]][[projection_time]]
})
})
out <- Reduce(c, out)
out <- Mapply(
\(r, nm) { names(r) <- nm ; return(r) },
out, names(out)
)
out <- Reduce(c, out)
out
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
# presence-absence | committee averaging
popaPlot(
projRasters = dis,
type = "adequation_environnementale",
ensemble_algorithm = "ca",
projection_time = "current"
)
app(out, sum)
app(out/1000, sum)
out
app(out, sum)/1000
app(out, sum)
out
dim(out)
nlayers(out)
nlyr(out)
app(out, sum)/nlyr(out)
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
# presence-absence | committee averaging
popaPlot(
projRasters = dis,
type = "adequation_environnementale",
ensemble_algorithm = "ca",
projection_time = "current"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "Majoidea",
ensemble_algorithm = "ca",
projection_time    = "current"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "Muricidae",
ensemble_algorithm = "ca",
projection_time    = "current"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "Muricoidea",
ensemble_algorithm = "ca",
projection_time    = "current"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "ca",
projection_time    = "ssp126"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "ca",
projection_time    = "current"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "ca",
projection_time    = "ssp585"
)
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "wmean",
projection_time    = "ssp585"
)
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "ca",
projection_time    = "ssp585"
)
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "ca",
projection_time    = "ssp585"
)
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/FUN/FUN_popaPlot.R")
# presence-absence | committee averaging
popaPlot(
projRasters        = dis,
type               = "adequation_environnementale",
superfamily        = "all",
ensemble_algorithm = "ca",
projection_time    = "ssp585"
)
