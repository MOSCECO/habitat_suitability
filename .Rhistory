NULL
)
patterns <- paste(binnam, algs, "0", sep = ".")
patterns
# paramètrage ----
algs     <- c(
# "rf5",
# "maxent5",
"ens5",
NULL
)
patterns <- paste(binnam, algs, "0", sep = ".")
patterns
my_pattern <- patterns[[1]]
my_name <- algs[[1]]
my_name
path_models <- here("data", "analysis", "models_mesu", supfam, bn)
list.files(path_models, pattern = my_pattern)
f <- list.files(path_models, pattern = my_pattern)[[1]]
f
list.files(
here(path_models, f, "proj_current"),
pattern = "\\.tif",
full.names = T
) %>%
rast()
list.files(
here(path_models, f)
)
here(path_models, f)
list.files(
here(path_models, f), pattern = ".out", full.names = T
)
f
list.files(
here(path_models, f),
pattern = paste0(f, "models.out"),
full.names = T
)
paste0(f, "models.out")
paste(f, "models", "out", sep = ".")
list.files(
here(path_models, f),
pattern = paste(f, "models", "out", sep = "."),
full.names = T
)
list.files(
here(path_models, f),
pattern = paste(f, "models", "out", sep = "."),
full.names = T
) %>% load()
list.files(
here(path_models, f),
pattern = paste(f, "models", "out", sep = "."),
full.names = T
)
path_models.out <- list.files(
here(path_models, f),
pattern = paste(f, "models", "out", sep = "."),
full.names = T
)
load(path_models.out)
Tel.rub.ens5.01.global.cpc.Tel.rub.ens5.01.global.cpc.models.out
Tel.rub.ens5.01.global.cpc.Tel.rub.ens5.01.global.cpc.models.out
path_models.out <- list.files(
here(path_models, f),
pattern = ".out",
full.names = T
)
load(path_models.out)
path_models.out
path_ens.out <- list.files(
here(path_models, f),
pattern = paste(f, "ensemble", "models", "out", sep = "."),
full.names = T
)
path_ens.out
load(path_ens.out)
Tel.rub.ens5.01.global.cpc.Tel.rub.ens5.01.global.cpc.ensemble.models.out
name_models.out <- list.files(
here(path_models, f),
pattern = paste(f, "models", "out", sep = ".")
)
name_models.out
a <- get(name_models.out)
a
a@models.prediction
a@formated.input.data
bmd <- get(name_models.out)
bmd
biomod2::get_built_models(bmd)
biomod2::get_kept_models(bmd)
biomod2::BIOMOD_LoadModels(bmd)
biomod2::BIOMOD_LoadModels(path_models.out)
biomod2::BIOMOD_LoadModels(bmd)
class(bmd)
biomod2::BIOMOD_LoadModels(bm.out = bmd)
biomod2::BIOMOD_LoadModels(bm.out = bmd)
?BIOMOD_LoadModels
biomod2::BIOMOD_LoadModels(bm.out = bmd, algo = "RF")
biomod2::BIOMOD_LoadModels(bm.out = bmd, algo = "MAXENT")
bmd
library(terra)
# Load species occurrences (6 species available)
data(DataSpecies)
head(DataSpecies)
# Select the name of the studied species
myRespName <- 'GuloGulo'
# Get corresponding presence/absence data
myResp <- as.numeric(DataSpecies[, myRespName])
# Get corresponding XY coordinates
myRespXY <- DataSpecies[, c('X_WGS84', 'Y_WGS84')]
# Load environmental variables extracted from BIOCLIM (bio_3, bio_4, bio_7, bio_11 & bio_12)
data(bioclim_current)
myExpl <- terra::rast(bioclim_current)
# ---------------------------------------------------------------
file.out <- paste0(myRespName, "/", myRespName, ".AllModels.models.out")
if (file.exists(file.out)) {
myBiomodModelOut <- get(load(file.out))
} else {
# Format Data with true absences
myBiomodData <- BIOMOD_FormatingData(resp.var = myResp,
expl.var = myExpl,
resp.xy = myRespXY,
resp.name = myRespName)
# Create default modeling options
myBiomodOptions <- BIOMOD_ModelingOptions()
# Model single models
myBiomodModelOut <- BIOMOD_Modeling(bm.format = myBiomodData,
modeling.id = 'AllModels',
models = c('RF', 'GLM'),
bm.options = myBiomodOptions,
CV.strategy = 'random',
CV.nb.rep = 2,
CV.perc = 0.8,
metric.eval = c('TSS','ROC'),
var.import = 3,
seed.val = 42)
}
# ---------------------------------------------------------------
# Loading some models built
BIOMOD_LoadModels(bm.out = myBiomodModelOut, algo = 'RF')
GuloGulo_allData_allRun_RF
class(myBiomodModelOut)
class(bmd)
myBiomodModelOut
bmd
BIOMOD_LoadModels(bm.out = bmd, algo = "RF")
bmd@dir.name
here(path_models, f)
bmd@dir.name <- here(path_models, f)
BIOMOD_LoadModels(bm.out = bmd, algo = "RF")
bmd@dir.name
f
bmd@dir.name <- here(path_models)
BIOMOD_LoadModels(bm.out = bmd, algo = "RF")
x11()
par(mfrow = c(1, 2), mar = rep(0, 4))
plot(dis$po$Muricoidea$Claremontiella_nodulosa$ens5_wmean)
plot(dis$po$Muricoidea$Vasula_deltoidea$ens5_wmean)
x11()
par(mfrow = c(1, 2), mar = rep(0, 4))
plot(dis$pa$Muricoidea$Claremontiella_nodulosa$ens5_wmean)
plot(dis$pa$Muricoidea$Vasula_deltoidea$ens5_wmean)
x11()
par(mfrow = c(1, 2), mar = rep(0, 4))
plot(dis$po$Majoidea$Omalacantha_bicornuta$ens5_wmean)
plot(dis$po$Majoidea$Stenorhynchus_seticornis$ens5_wmean)
x11()
par(mfrow = c(1, 2), mar = rep(0, 4))
plot(dis$pa$Muricoidea$Omalacantha_bicornuta$ens5_wmean)
dis$pa$Muricoidea$Omalacantha_bicornuta$ens5_wmean
x11()
par(mfrow = c(1, 2), mar = rep(0, 4))
plot(dis$pa$Majoidea$Omalacantha_bicornuta$ens5_wmean)
plot(dis$pa$Majoidea$Stenorhynchus_seticornis$ens5_wmean)
nc <- read_stars("/home/borea/Downloads/sst_proj.nc")
nc
x11(); plot(nc)
nc <- rast("/home/borea/Downloads/sst_proj.tiff")
nc
r <- rast("/home/borea/Downloads/sst_proj.tiff")
x11(); plot(r)
maps$GLP
maps$GLP %>% st_centroid
maps$GLP %>% st_union() %>% st_centroid()
maps$GLP %>% st_union() %>% st_transform(crs = utm20n) %>%  st_centroid()
maps$GLP %>% st_union() %>% st_transform(crs = utm20n) %>%  st_centroid() %>% st_transform(crs = wgs)
maps %>%
lapply(st_union) %>%
lapply(st_transform, crs = utm20n) %>%
lapply(st_centroid) %>%
lapply(st_transform, crs = wgs)
cds <- maps %>%
lapply(st_union) %>%
lapply(st_transform, crs = utm20n) %>%
lapply(st_centroid) %>%
lapply(st_transform, crs = wgs)
extract(r, cds)
extract(cds, r)
cds <- maps %>%
lapply(st_union) %>%
lapply(st_transform, crs = utm20n) %>%
lapply(st_centroid) %>%
lapply(st_transform, crs = wgs) %>%
lapply(st_coordinates)
terra::extract(r, Reduce(cds, rbind))
Reduce(cds, rbind)
Reduce(rbind, cds)
terra::extract(r, Reduce(rbind, cds))
ssp126 <- read.csv(here("data", "raw", "projection", "sst_proj_ssp1-2.6.csv"))
ssp126 <- read.csv(
here("data", "raw", "projection", "sst_proj_ssp1-2.6.csv")
)
ssp126 <- read.csv(
here("data", "raw", "projection", "sst_proj_ssp126.csv")
)
ssp585 <- read.csv(
here("data", "raw", "projection", "sst_proj_ssp585.csv")
)
ssp585
ssp126$P5[ssp126$Scenario == "Medium Term (2041-2060)"]
ssp126$P5[ssp126$Period == "Medium Term (2041-2060)"]
sst_minimal_change <- ssp126$P5[ssp126$Period == "Medium Term (2041-2060)"]
sst_maximal_change <- ssp585$P95[ssp585$Period == "Medium Term (2041-2060)"]
sst_maximal_change
sst_minimal_change
# CMIP6 - Sea level rise (SLR) Change meters -
# Medium Term (2041-2060) SSP1-2.6 (rel. to 1995-2014) - Annual -CAR
slr126 <- read.csv(here("data", "raw", "projection", "slr_proj_ssp126.csv"))
# Medium Term (2041-2060) SSP5-8.5 (rel. to 1995-2014) - Annual -CAR
slr585 <- read.csv(here("data", "raw", "projection", "slr_proj_ssp585.csv"))
# CMIP6 - Sea level rise (SLR) Change meters -
# Medium Term (2041-2060) SSP1-2.6 (rel. to 1995-2014) - Annual -CAR
slr126 <- read.csv(here("data", "raw", "projection", "slr_proj_ssp126.csv"))
# Medium Term (2041-2060) SSP5-8.5 (rel. to 1995-2014) - Annual -CAR
slr585 <- read.csv(here("data", "raw", "projection", "slr_proj_ssp585.csv"))
slr_minimal_change <- slr126$P5[slr126$Period == "Medium Term (2041-2060)"]
slr_maximal_change <- slr585$P5[slr585$Period == "Medium Term (2041-2060)"]
slr_minimal_change
slr_maximal_change
slr_minimal_change <- slr126$P5[slr126$Period == "Medium Term (2041-2060)"]
slr_maximal_change <- slr585$P95[slr585$Period == "Medium Term (2041-2060)"]
slr_minimal_change
slr_maximal_change
source("~/Documents/mosceco/r_projects/MOSCECO_L2/habitat_suitability/scripts/boot.R", echo=TRUE)
# Projection futures : scénarios du GIEC ----
source(here("scripts", "giec_sst_slr.R"))
source(here("scripts", "data_environment_ipcc.R"))
climosaic_ssp126 <- climosaic
climosaic_ssp126 <- climosaic
climosaic_ssp126$depth <- climosaic_ssp126$depth + slr_minimal_change
climosaic_ssp126$mean.sst <- climosaic_ssp126$mean.sst + sst_minimal_change
climosaic_ssp126$stdv.sst <- climosaic_ssp126$stdv.sst + sst_minimal_change
climosaic_ssp126$mean.sbt <- climosaic_ssp126$mean.sbt + sst_minimal_change
climosaic_ssp126$stdv.sbt <- climosaic_ssp126$stdv.sbt + sst_minimal_change
climosaic_ssp585 <- climosaic
climosaic_ssp585$depth <- climosaic_ssp585$depth + slr_minimal_change
climosaic_ssp585$mean.sst <- climosaic_ssp585$mean.sst + sst_minimal_change
climosaic_ssp585$stdv.sst <- climosaic_ssp585$stdv.sst + sst_minimal_change
climosaic_ssp585$mean.sbt <- climosaic_ssp585$mean.sbt + sst_minimal_change
climosaic_ssp585$stdv.sbt <- climosaic_ssp585$stdv.sbt + sst_minimal_change
source(here("scripts", "data_environment_ipcc.R"))
clim_sub      <- cgc_sub[[supfam]][[bn]]
clim_proj_sub <- subset(climosaic_ssp126, names(clim_sub))
supfam <- "Majoidea"
bn     <- "Stenorhynchus seticornis"
clim_sub      <- cgc_sub[[supfam]][[bn]]
clim_proj_sub <- subset(climosaic_ssp126, names(clim_sub))
# supfam <- "Majoidea"
# bn     <- "Stenorhynchus seticornis"
path_models_out <- here("data", "analysis", "models", supfam, bn)
pth <- list.files(path_models_out, full.names = T)[[1]]
# pth <- list.files(path_models_out, full.names = T)[[1]]
pth_out <- list.files(
pth, pattern = "ensemble.models.out", full.names = T
)
nam_out <- list.files(pth, pattern = "ensemble.models.out")
load(pth_out)
mod_ensemble <- get(nam_out)
# mod_ensemble@dir.name        <- path_models_out
# mod_ensemble@link            <- pth_out
mod_ensemble@models.out@link <- pth_out
pathClusterBiomod <- function(x) {
gsub(
"/scratchbeta/manielg",
"/home/borea/Documents/mosceco/r_projects",
x
)
}
mod_ensemble@models.out@link <- mod_ensemble@models.out@link %>%
pathClusterBiomod()
mod_ensemble@models.evaluation@link <- mod_ensemble@models.evaluation@link %>%
pathClusterBiomod()
mod_ensemble@variables.importance@link <- mod_ensemble@variables.importance@link %>%
pathClusterBiomod()
mod_ensemble@models.prediction@link <- mod_ensemble@models.prediction@link %>%
pathClusterBiomod()
mod_ensemble@models.prediction.eval@link <- mod_ensemble@models.prediction.eval@link %>%
pathClusterBiomod()
mod_ensemble@link <- mod_ensemble@link %>% pathClusterBiomod()
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
mod_ensemble
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
pth_out
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
pth
pth_out
pth
# mod_ensemble@dir.name        <- path_models_out
# mod_ensemble@link            <- pth_out
mod_ensemble@models.out@link <- pth
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
pth
# mod_ensemble@dir.name        <- path_models_out
# mod_ensemble@link            <- pth_out
mod_ensemble@models.out@link <- pth %>% paste0("/")
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
pth_out
# mod_ensemble@dir.name        <- path_models_out
# mod_ensemble@link            <- pth_out
mod_ensemble@models.out@link <- pth_out
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
source("~/.active-rstudio-document", echo=TRUE)
source("~/.active-rstudio-document", echo=TRUE)
library(biomod2)
source("~/.active-rstudio-document", echo=TRUE)
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting2(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
BIOMOD_EnsembleForecasting
mod_ensemble
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn)
)
pth_out
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc")
)
pth_out
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out"
)
pth_out
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out"
)
load(pth_out)
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out"
)
pth_out
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out", full.names = T
)
load(pth_out)
mod_ensemble <- get(nam_out)
nam_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out"
)
load(pth_out)
mod_ensemble <- get(nam_out)
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
library(biomod2)
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
unload("biomod2")
library(biomod2)
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
source(here::here("scripts", "boot.R"))
# Projection futures : scénarios du GIEC ----
source(here("scripts", "giec_sst_slr.R"))
source(here("scripts", "data_environment_ipcc.R"))
supfam <- "Majoidea"
bn     <- "Stenorhynchus seticornis"
# supfam <- "Majoidea"
# bn     <- "Stenorhynchus seticornis"
path_models_out <- here("data", "analysis", "models", supfam, bn)
pth <- list.files(path_models_out, full.names = T)[[1]]
pth_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out", full.names = T
)
nam_out <- list.files(
here("data", "analysis", "models", supfam, bn,
"Ste.set.ens5.01.global.cpc"),
pattern = "ensemble.models.out"
)
load(pth_out)
mod_ensemble <- get(nam_out)
# mod_ensemble@dir.name        <- path_models_out
# mod_ensemble@link            <- pth_out
mod_ensemble@models.out@link <- pth_out
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
clim_sub      <- cgc_sub[[supfam]][[bn]]
clim_proj_sub <- subset(climosaic_ssp126, names(clim_sub))
# Projection dans un scénario ----
proj_ipcc <- BIOMOD_EnsembleForecasting(
bm.em         = mod_ensemble,
new.env       = clim_proj_sub,
proj.name     = "forecast",
models.chosen = "all"
)
mod_ensemble@models.out@link <- mod_ensemble@models.out@link %>%
pathClusterBiomod()
pathClusterBiomod <- function(x) {
gsub(
"/scratchbeta/manielg",
"/home/borea/Documents/mosceco/r_projects",
x
)
}
mod_ensemble@models.out@link <- mod_ensemble@models.out@link %>%
pathClusterBiomod()
mod_ensemble@models.evaluation@link <- mod_ensemble@models.evaluation@link %>%
pathClusterBiomod()
mod_ensemble@variables.importance@link <- mod_ensemble@variables.importance@link %>%
pathClusterBiomod()
mod_ensemble@models.prediction@link <- mod_ensemble@models.prediction@link %>%
pathClusterBiomod()
mod_ensemble@models.prediction.eval@link <- mod_ensemble@models.prediction.eval@link %>%
pathClusterBiomod()
mod_ensemble@link <- mod_ensemble@link %>% pathClusterBiomod()
mod_ensemble@models.prediction@link
mod_ensemble@models.prediction.eval@link
mod_ensemble@link
mod_ensemble@models.evaluation@link
mod_ensemble@variables.importance@link
mod_ensemble@models.prediction@link
mod_ensemble@models.prediction@link %>% file.exists()
load(mod_ensemble@models.prediction@link)
o <- get(models.prediciton)
o <- get(models.prediction)
o <- get(models.prediction)
e <- load(mod_ensemble@models.prediction@link)
e
get(objValue)
